# 實作計劃

## 專案設定與基礎架構

- [x] 1. 建立專案結構和初始配置



  - 建立 .NET Core 8 Web API 專案
  - 建立 Vue 3 前端專案
  - 設定 Docker 開發環境
  - 配置 appsettings.json 和環境變數
  - _需求：12.2, 15.1, 15.2_

- [x] 2. 設定資料庫和 Entity Framework Core






  - 執行資料庫建立腳本（00_CreateDatabase.sql）
  - 執行資料表建立腳本（01_CreateTables.sql）
  - 執行外鍵關聯腳本（03_AddMissingRelations.sql）
  - 執行初始資料腳本（02_SeedData.sql）
  - 使用 Scaffold 指令產生 Entity 類別
  - 配置 DbContext 和連線字串
  - _需求：15.3_

- [x] 3. 設定 LDAP 整合和身份驗證




  - 安裝跨平台 LDAP 函式庫（如 Novell.Directory.Ldap.NETStandard）
  - 實作 ILdapService 介面（驗證憑證、取得使用者詳細資訊、取得群組）
  - 配置 JWT 令牌產生和驗證（使用 Microsoft.AspNetCore.Authentication.JwtBearer）
  - 實作 IAuthenticationService 介面（登入、驗證令牌、取得使用者資訊）
  - 實作 AD 使用者首次登入時自動建立員工記錄的邏輯
  - 實作 AD 使用者資訊同步機制（背景服務或手動觸發）
  - 實作 AD 使用者停用時撤銷系統存取權限的邏輯
  - 實作 AD 連線失敗的錯誤處理和日誌記錄
  - 實作從 AD 取得使用者角色和權限資訊並對應到系統角色
  - _需求：3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7_

- [ ]* 3.1 撰寫 LDAP 連線測試
  - 測試 LDAP 連線和身份驗證
  - 測試 AD 使用者資訊同步
  - 測試錯誤處理機制
  - _需求：3.1, 3.7_

## 核心領域層實作

- [x] 4. 實作權限管理模組



  - 實作 IAuthorizationService 介面
  - 實作 IRoleService 介面
  - 實作資料存取範圍過濾邏輯
  - 建立權限驗證中介軟體
  - _需求：7.2, 7.3, 7.4, 7.6, 7.7_

- [ ]* 4.1 撰寫權限控制屬性測試
  - **屬性 8：功能存取控制**
  - **驗證：需求 7.5**

- [ ]* 4.2 撰寫資料範圍過濾屬性測試
  - **屬性 9：資料範圍過濾**
  - **驗證：需求 7.7**

- [x] 5. 實作員工管理模組
  - 實作 IEmployeeService 介面
  - 實作員工 CRUD 操作
  - 實作部門調動功能
  - 實作員工狀態管理
  - _需求：8.1, 8.2, 8.3, 8.4, 6.6_

- [ ]* 5.1 撰寫員工管理單元測試
  - 測試員工建立、更新、查詢
  - 測試部門調動
  - _需求：8.1, 8.2, 8.3_


- [x] 6. 實作部門管理模組



  - 實作部門 CRUD 操作
  - 實作組織階層管理
  - 實作部門停用驗證邏輯
  - _需求：6.1, 6.2, 6.3, 6.4, 6.5_

- [ ]* 6.1 撰寫部門停用安全性屬性測試
  - **屬性 7：部門停用安全性**
  - **驗證：需求 6.4**

- [x] 7. 實作請假管理模組
  - 實作 ILeaveService 介面
  - 實作請假申請功能
  - 實作代理請假流程
  - 實作請假日期重疊驗證
  - 實作假期額度計算
  - _需求：9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.7, 9.8, 9.9_

- [ ]* 7.1 撰寫請假日期重疊屬性測試
  - **屬性 10：請假日期不重疊**
  - **驗證：需求 9.4**

- [ ]* 7.2 撰寫代理請假記錄完整性屬性測試
  - **屬性 11：代理請假記錄完整性**
  - **驗證：需求 9.6**

## 薪資計算核心功能

- [ ] 8. 實作薪資項目管理
  - 實作薪資項目定義 CRUD
  - 實作項目類型和計算方式管理
  - 實作項目版本控制
  - _需求：10.1, 10.2, 10.3, 10.4, 10.5, 10.6, 10.7_

- [ ] 9. 實作費率表管理
  - 實作費率表 CRUD 操作
  - 實作費率表版本管理
  - 實作費率表匯入功能（檔案上傳）
  - 實作費率表歷史查詢
  - _需求：11.1, 11.2, 11.4, 11.5, 11.6_

- [ ]* 9.1 撰寫費率表版本正確性屬性測試
  - **屬性 15：費率表版本正確性**
  - **驗證：需求 12.9**

- [ ] 10. 實作薪資計算引擎
  - 實作 IPayrollCalculationService 介面
  - 實作基本薪資計算（月薪 × 出勤比例）
  - 實作請假扣款計算
  - 實作加班費計算
  - 實作薪資加項和減項處理
  - 實作上月資料載入和複製功能
  - _需求：12.1, 12.2, 12.3, 12.4, 12.5, 12.6, 12.7, 12.8_

- [ ]* 10.1 撰寫上月資料載入屬性測試
  - **屬性 12：上月資料載入**
  - **驗證：需求 12.1**

- [ ]* 10.2 撰寫薪資計算正確性屬性測試
  - **屬性 13：薪資計算正確性**
  - **驗證：需求 12.2**

- [ ]* 10.3 撰寫薪資項目複製一致性屬性測試
  - **屬性 14：薪資項目複製一致性**
  - **驗證：需求 12.8**


- [ ] 11. 實作稅務計算模組
  - 實作 ITaxCalculationService 介面
  - 實作所得稅累進稅率計算
  - 實作勞保費計算
  - 實作健保費計算
  - 實作扣除額和免稅額處理
  - _需求：12.9, 12.10, 18.1, 18.2_

- [ ]* 11.1 撰寫累進稅率計算正確性屬性測試
  - **屬性 18：累進稅率計算正確性**
  - **驗證：需求 18.1**

- [ ] 12. 實作薪資記錄管理
  - 實作薪資記錄 CRUD 操作
  - 實作薪資狀態管理（草稿/已核准/已發放）
  - 實作薪資修改歷史記錄
  - 實作交易回滾機制
  - _需求：12.11, 12.12, 12.13_

- [ ]* 12.1 撰寫薪資記錄單元測試
  - 測試薪資記錄建立和更新
  - 測試狀態轉換
  - _需求：12.11, 12.12_

## 通知與檔案產生

- [ ] 13. 實作薪資通知模組
  - 實作 INotificationService 介面
  - 實作 IEmailService 介面
  - 實作郵件範本管理
  - 實作通知發送失敗重試機制
  - _需求：1.1, 1.2, 1.3, 1.4, 1.5_

- [ ]* 13.1 撰寫通知完整性屬性測試
  - **屬性 1：通知完整性**
  - **驗證：需求 1.1**

- [ ] 14. 實作附件加密功能
  - 實作薪資明細 PDF 產生
  - 實作 PDF 密碼加密
  - 實作密碼產生邏輯（員工編號/身份證字號）
  - 整合到郵件發送流程
  - _需求：1.6, 1.7, 1.8_

- [ ]* 14.1 撰寫附件加密一致性屬性測試
  - **屬性 2：附件加密一致性**
  - **驗證：需求 1.6**

- [ ]* 14.2 撰寫密碼產生正確性屬性測試
  - **屬性 3：密碼產生正確性**
  - **驗證：需求 1.7**

- [ ] 15. 實作銀行轉帳檔案產生
  - 實作 IBankTransferService 介面
  - 實作銀行帳號格式驗證
  - 實作轉帳檔案格式產生（支援多種銀行格式）
  - 實作檔案編碼處理（Big5/UTF-8）
  - 實作轉帳批次管理
  - _需求：2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [ ]* 15.1 撰寫帳號驗證完整性屬性測試
  - **屬性 4：帳號驗證完整性**
  - **驗證：需求 2.2**

- [ ]* 15.2 撰寫檔案格式一致性屬性測試
  - **屬性 5：檔案格式一致性**
  - **驗證：需求 2.3**


## 報表與年度作業

- [ ] 16. 實作報表產生模組
  - 實作 IReportService 介面
  - 實作 IExportService 介面
  - 實作薪資總表報表
  - 實作 PDF 匯出功能
  - 實作 Excel 匯出功能
  - 實作 CSV 匯出功能
  - 實作報表篩選功能
  - _需求：16.1, 16.2, 16.3, 16.4, 16.5_

- [ ]* 16.1 撰寫報表產生單元測試
  - 測試各種格式匯出
  - 測試報表篩選
  - _需求：16.1, 16.2, 16.5_

- [ ] 17. 實作扣繳憑單產生
  - 實作年度所得計算
  - 實作扣繳憑單格式產生
  - 實作國稅局電子申報格式匯出
  - _需求：18.3, 18.4, 18.5, 18.6, 18.7_

- [ ] 18. 實作年度作業模組
  - 實作 IYearEndService 介面
  - 實作年度結算功能
  - 實作年度薪資總表產生
  - 實作年度累計數據重置
  - 實作資料封存功能
  - 實作已結算資料保護
  - _需求：19.1, 19.2, 19.3, 19.4, 19.5, 19.6, 19.7_

- [ ]* 18.1 撰寫年度累計重置屬性測試
  - **屬性 19：年度累計重置**
  - **驗證：需求 19.3**

- [ ]* 18.2 撰寫已結算資料不可修改屬性測試
  - **屬性 20：已結算資料不可修改**
  - **驗證：需求 19.7**

## 系統設定與管理

- [ ] 19. 實作系統參數管理
  - 實作 ISystemConfigService 介面
  - 實作系統參數 CRUD 操作
  - 實作參數版本控制
  - 實作工作日曆管理
  - 實作參數生效日期處理
  - _需求：13.1, 13.2, 13.3, 13.4, 13.5, 13.6, 13.7, 13.8, 13.9, 13.10, 13.11_

- [ ]* 19.1 撰寫系統參數管理單元測試
  - 測試參數 CRUD
  - 測試版本控制
  - _需求：13.9, 13.10, 13.11_

- [ ] 20. 實作異常偵測與警示
  - 實作薪資異常變動偵測（30% 門檻）
  - 實作重複銀行帳號偵測
  - 實作異常薪資金額檢查
  - 實作警示通知機制
  - 實作異常記錄管理
  - _需求：17.1, 17.2, 17.3, 17.5, 17.6_

- [ ]* 20.1 撰寫薪資異常變動偵測屬性測試
  - **屬性 16：薪資異常變動偵測**
  - **驗證：需求 17.1**

- [ ]* 20.2 撰寫重複帳號偵測屬性測試
  - **屬性 17：重複帳號偵測**
  - **驗證：需求 17.2**


## 資料安全與稽核

- [ ] 21. 實作資料加密功能
  - 實作 AES-256 加密服務
  - 實作敏感欄位加密（銀行帳號、薪資金額）
  - 實作加密金鑰管理
  - 整合到 Entity Framework Core
  - _需求：5.2_

- [ ]* 21.1 撰寫敏感資料加密屬性測試
  - **屬性 6：敏感資料加密**
  - **驗證：需求 5.2**

- [ ] 22. 實作稽核日誌系統
  - 實作稽核日誌記錄中介軟體
  - 實作操作日誌自動記錄
  - 實作日誌查詢介面
  - 實作未授權存取記錄
  - _需求：5.1, 5.3, 5.4_

- [ ]* 22.1 撰寫稽核日誌單元測試
  - 測試日誌記錄
  - 測試日誌查詢
  - _需求：5.3_

## API 層實作

- [ ] 23. 實作身份驗證 API
  - 實作登入端點（POST /api/auth/login）
  - 實作令牌驗證端點
  - 實作使用者資訊端點
  - 實作登出端點
  - _需求：3.1, 14.5_

- [ ] 24. 實作員工管理 API
  - 實作員工 CRUD 端點
  - 實作部門調動端點
  - 實作員工查詢端點（支援篩選）
  - 套用權限驗證
  - _需求：8.1, 8.2, 8.3, 8.4, 6.6_

- [ ] 25. 實作部門管理 API
  - 實作部門 CRUD 端點
  - 實作組織階層查詢端點
  - 套用權限驗證
  - _需求：6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 26. 實作請假管理 API
  - 實作請假申請端點
  - 實作代理請假端點
  - 實作請假確認/拒絕端點
  - 實作出勤記錄查詢端點
  - _需求：9.1, 9.5, 9.6, 9.7, 9.8_

- [ ] 27. 實作薪資管理 API
  - 實作薪資計算端點
  - 實作薪資記錄 CRUD 端點
  - 實作薪資查詢端點（支援篩選和分頁）
  - 實作薪資匯出端點
  - 套用資料存取範圍過濾
  - _需求：4.1, 4.2, 4.3, 4.4, 4.5, 12.1-12.13_

- [ ] 28. 實作報表 API
  - 實作薪資總表端點
  - 實作年度報表端點
  - 實作扣繳憑單端點
  - 實作報表匯出端點（支援多種格式）
  - _需求：16.1, 16.2, 16.3, 16.4, 16.5_

- [ ] 29. 實作系統管理 API
  - 實作角色管理端點
  - 實作權限管理端點
  - 實作系統參數管理端點
  - 實作費率表管理端點
  - 實作薪資項目定義管理端點
  - _需求：7.1, 7.2, 7.3, 13.1-13.11, 11.1-11.6, 10.1-10.7_


- [ ] 30. 實作 API 錯誤處理和驗證
  - 實作全域異常處理器
  - 實作請求驗證中介軟體
  - 實作標準化錯誤回應格式
  - 實作 API 效能監控
  - _需求：14.2, 14.3, 14.4_

- [ ]* 30.1 撰寫 API 整合測試
  - 測試各 API 端點
  - 測試錯誤處理
  - 測試權限驗證
  - _需求：14.1, 14.2, 14.3, 14.4, 14.5_

## 前端實作

- [ ] 31. 建立 Vue 3 專案結構
  - 初始化 Vue 3 專案（使用 Vite）
  - 設定 Vue Router
  - 設定 Pinia 狀態管理
  - 設定 Axios HTTP 客戶端
  - 建立基礎元件庫
  - _需求：14.1_

- [ ] 32. 實作登入與身份驗證
  - 實作登入頁面
  - 實作 JWT 令牌管理
  - 實作路由守衛
  - 實作自動登出機制
  - _需求：3.1_

- [ ] 33. 實作員工薪資查詢介面
  - 實作薪資記錄列表頁面
  - 實作薪資明細頁面
  - 實作薪資篩選功能
  - 實作薪資匯出功能（PDF）
  - 實作權限控制（僅查看自己的薪資）
  - _需求：4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 34. 實作管理員介面 - 員工管理
  - 實作員工列表頁面
  - 實作員工新增/編輯表單
  - 實作部門調動功能
  - 實作員工查詢和篩選
  - _需求：8.1, 8.2, 8.3, 8.4_

- [ ] 35. 實作管理員介面 - 部門管理
  - 實作部門列表頁面
  - 實作部門新增/編輯表單
  - 實作組織架構樹狀圖
  - _需求：6.1, 6.2, 6.3, 6.5_

- [ ] 36. 實作管理員介面 - 請假管理
  - 實作請假申請表單
  - 實作代理請假功能
  - 實作請假記錄列表
  - 實作請假確認/拒絕功能
  - _需求：9.1, 9.5, 9.6, 9.7, 9.8_

- [ ] 37. 實作管理員介面 - 薪資計算
  - 實作薪資計算頁面
  - 實作上月資料帶入功能
  - 實作薪資項目編輯
  - 實作薪資預覽和確認
  - 實作批次薪資計算
  - _需求：12.1, 12.2, 12.8, 12.10_

- [ ] 38. 實作管理員介面 - 薪資管理
  - 實作薪資記錄列表（支援篩選）
  - 實作薪資明細查看
  - 實作薪資狀態管理
  - 實作薪資修改功能
  - _需求：12.11, 12.12_


- [ ] 39. 實作管理員介面 - 報表功能
  - 實作報表查詢頁面
  - 實作報表篩選功能
  - 實作報表匯出功能（PDF/Excel/CSV）
  - 實作年度報表查看
  - _需求：16.1, 16.2, 16.5_

- [ ] 40. 實作管理員介面 - 系統設定
  - 實作角色管理頁面
  - 實作權限設定頁面
  - 實作系統參數設定頁面
  - 實作費率表管理頁面
  - 實作薪資項目定義管理頁面
  - _需求：7.1, 7.2, 13.1-13.11, 11.1-11.6, 10.1-10.7_

- [ ] 41. 實作通知與警示功能
  - 實作系統通知元件
  - 實作異常警示列表
  - 實作警示確認功能
  - _需求：17.5, 17.6_

- [ ] 42. 實作前端錯誤處理
  - 實作全域錯誤處理
  - 實作 API 錯誤提示
  - 實作載入狀態管理
  - 實作離線偵測
  - _需求：14.2, 14.3_

- [ ]* 42.1 撰寫前端單元測試
  - 測試關鍵元件
  - 測試狀態管理
  - 測試路由守衛

## Docker 與部署

- [ ] 43. 建立 Docker 配置
  - 建立後端 Dockerfile
  - 建立前端 Dockerfile
  - 建立 docker-compose.yml
  - 配置 MS SQL Server 容器
  - 配置網路和卷宗
  - _需求：15.1, 15.6_

- [ ] 44. 配置環境變數和設定
  - 建立環境變數範本
  - 配置資料庫連線字串
  - 配置 AD 伺服器設定
  - 配置郵件伺服器設定
  - 配置加密金鑰
  - _需求：15.2, 15.3_

- [ ] 45. 實作日誌系統
  - 配置結構化日誌
  - 實作日誌輸出至標準輸出
  - 配置日誌等級
  - 整合 Docker 日誌收集
  - _需求：15.7_

- [ ] 46. 實作健康檢查
  - 實作 API 健康檢查端點
  - 實作資料庫連線檢查
  - 實作 AD 連線檢查
  - 配置 Docker 健康檢查
  - _需求：15.6_


## 測試與品質保證

- [ ] 47. 設定測試框架
  - 設定 xUnit 測試專案
  - 設定 FsCheck 屬性測試框架
  - 設定測試資料產生器
  - 配置測試覆蓋率工具
  - _需求：測試策略_

- [ ] 48. 執行所有屬性測試
  - 確保所有 20 個屬性測試通過
  - 每個測試執行至少 100 次迭代
  - 記錄測試結果和覆蓋率
  - _需求：所有正確性屬性_

- [ ] 49. 執行整合測試
  - 測試 API 端點整合
  - 測試資料庫整合
  - 測試 AD 整合（使用測試 LDAP）
  - 測試郵件發送整合
  - _需求：14.1-14.5_

- [ ] 50. 效能測試
  - 測試 API 回應時間（< 2 秒）
  - 測試報表產生時間（< 30 秒）
  - 測試大量資料處理
  - 測試並發請求處理
  - _需求：14.4, 16.4_

- [ ]* 50.1 撰寫效能測試報告
  - 記錄效能測試結果
  - 識別效能瓶頸
  - 提出優化建議

## 文件與部署準備

- [ ] 51. 撰寫 API 文件
  - 使用 Swagger/OpenAPI 產生 API 文件
  - 撰寫 API 使用範例
  - 撰寫錯誤碼說明
  - _需求：14.1_

- [ ] 52. 撰寫部署文件
  - 撰寫 Docker 部署指南
  - 撰寫環境變數說明
  - 撰寫資料庫初始化指南
  - 撰寫備份和還原指南
  - _需求：15.1-15.8_

- [ ] 53. 撰寫使用者手冊
  - 撰寫員工使用手冊
  - 撰寫管理員操作手冊
  - 撰寫系統管理員手冊
  - 建立操作影片或截圖

- [ ] 54. 安全性檢查
  - 檢查敏感資料加密
  - 檢查 SQL 注入防護
  - 檢查 XSS 防護
  - 檢查 CSRF 防護
  - 檢查權限控制
  - _需求：5.1-5.5_

## 最終檢查點

- [ ] 55. 系統整合測試
  - 執行完整的端對端測試
  - 測試所有使用者流程
  - 驗證所有需求已實作
  - 確認所有測試通過

- [ ] 56. 使用者驗收測試準備
  - 準備測試環境
  - 準備測試資料
  - 準備測試案例
  - 安排使用者測試

- [ ] 57. 生產環境準備
  - 建立生產環境配置
  - 設定監控和警示
  - 設定備份策略
  - 準備上線檢查清單

---

## 任務統計

- **總任務數**: 57
- **核心實作任務**: 42
- **測試任務**: 23（標記為 *）
- **文件任務**: 4
- **部署任務**: 4

## 預估時程

- **階段 1 - 基礎架構** (任務 1-3): 1 週
- **階段 2 - 核心領域層** (任務 4-12): 3 週
- **階段 3 - 通知與檔案** (任務 13-15): 2 週
- **階段 4 - 報表與年度** (任務 16-18): 2 週
- **階段 5 - 系統管理** (任務 19-22): 1 週
- **階段 6 - API 層** (任務 23-30): 2 週
- **階段 7 - 前端實作** (任務 31-42): 4 週
- **階段 8 - 部署與測試** (任務 43-57): 2 週

**總預估時程**: 17 週（約 4 個月）

## 注意事項

1. 標記 * 的任務為可選測試任務，可根據專案時程調整
2. 屬性測試必須在對應功能實作完成後立即執行
3. 每個階段結束時應執行整合測試
4. 建議採用敏捷開發方式，每 2 週一個迭代
5. 優先實作核心薪資計算功能，其他功能可分階段交付
