---
inclusion: always
---

# 任務執行規範

## 核心原則

### 完整實作要求

**所有任務中的要求都必須完整實作，不能跳過任何子任務。**

## 執行規則

### 1. 任務完整性

- ✅ **必須實作**：任務清單中的所有子任務都必須完整實作
- ✅ **不能跳過**：即使遇到困難，也不能跳過任何子任務
- ✅ **逐項完成**：按照任務清單的順序，逐項完成每個子任務

### 2. 可選任務標記

- 標記 `*` 的任務為可選任務（如測試任務）
- 可選任務可以根據專案需求決定是否實作
- 但如果決定實作，也必須完整完成

### 3. 失敗處理

當任務執行失敗時：

1. **記錄失敗原因**：詳細記錄失敗的具體原因和錯誤訊息
2. **嘗試解決**：嘗試不同的方法解決問題（最多 2-3 次）
3. **詢問使用者**：如果無法解決，必須詢問使用者如何處理
4. **不能自行跳過**：絕對不能在未經使用者同意的情況下跳過任務

### 4. 詢問使用者的時機

在以下情況下必須詢問使用者：

- ❌ 任務執行失敗且嘗試多次仍無法解決
- ❌ 遇到技術限制無法實作
- ❌ 需要外部資源或權限才能完成
- ❌ 任務需求不明確或有歧義
- ❌ 發現任務與其他任務有衝突

### 5. 詢問格式

當需要詢問使用者時，應該：

```
❌ 任務執行失敗

**任務**: [任務編號和名稱]
**子任務**: [具體的子任務]
**失敗原因**: [詳細說明失敗原因]
**已嘗試的方法**: 
1. [方法 1]
2. [方法 2]
3. [方法 3]

**請問您想要如何處理？**
1. 繼續嘗試其他方法
2. 暫時跳過此子任務，稍後回來處理
3. 修改任務需求
4. 其他建議
```

## 任務狀態管理

### 使用 taskStatus 工具

- 開始任務前：設定狀態為 `in_progress`
- 完成任務後：設定狀態為 `completed`
- 失敗時：保持 `in_progress` 狀態，詢問使用者後再決定

### 任務完成標準

一個任務只有在以下情況下才能標記為 `completed`：

- ✅ 所有子任務都已完成
- ✅ 程式碼已撰寫並通過基本驗證
- ✅ 相關測試已執行（如果有）
- ✅ 沒有明顯的錯誤或問題

## 特殊情況

### 測試任務

- 標記 `*` 的測試任務為可選
- 如果使用者要求實作測試，則必須完整實作
- 測試失敗時，應該修正程式碼而不是跳過測試

### 依賴任務

- 如果任務依賴其他任務，必須先完成依賴任務
- 不能因為依賴任務未完成而跳過當前任務
- 應該先回去完成依賴任務

### 外部依賴

- 如果任務需要外部服務（如 LDAP、郵件伺服器），但環境中沒有
- 應該實作完整的程式碼邏輯
- 可以使用模擬（Mock）進行測試
- 但不能因為沒有外部服務就跳過實作

## 禁止行為

### ❌ 絕對不能做的事

1. **不能自行跳過任務**：未經使用者同意，不能跳過任何非可選任務
2. **不能簡化需求**：不能為了方便實作而自行簡化任務需求
3. **不能假裝完成**：不能在未完成的情況下標記任務為完成
4. **不能隱藏錯誤**：不能隱藏或忽略執行過程中的錯誤
5. **不能放棄嘗試**：遇到困難時，必須嘗試多種方法解決

## 範例

### ✅ 正確的處理方式

```
任務：實作 LDAP 整合

子任務 1: 安裝 LDAP 函式庫 ✅
子任務 2: 實作 ILdapService 介面 ✅
子任務 3: 配置 JWT 令牌 ✅
子任務 4: 實作錯誤處理 ❌ 失敗

失敗原因：不確定應該捕捉哪些異常類型

已嘗試：
1. 查看 LDAP 函式庫文件
2. 實作基本的 try-catch
3. 參考設計文件

請問您想要如何處理？
```

### ❌ 錯誤的處理方式

```
任務：實作 LDAP 整合

子任務 1: 安裝 LDAP 函式庫 ✅
子任務 2: 實作 ILdapService 介面 ✅
子任務 3: 配置 JWT 令牌 ✅
子任務 4: 實作錯誤處理 ⏭️ 跳過（太複雜了）

任務完成！✅
```

## 總結

**記住：完整性比速度更重要。寧可花更多時間完整實作，也不要為了快速完成而跳過任務。**
